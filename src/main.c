#include "disas.h"

int main()
{
	struct disassembler *ds = ds_init(X86_ARCH, MODE_32B);

	unsigned char bytes[] = "\x55\x89\xe5\x83\xec\x10\xe8\x44\x00\x00\x00\x05\xee\x1a\x00\x00\xc7\x45\xf8\x00\x00\x00\x00\xc7\x45\xfc\x00\x00\x00\x00\xeb\x22\x8b\x45\xfc\x2b\x45\xf8\x8b\x4d\xf8\x8b\x55\xfc\x01\xca\x50\xff\x75\xfc\x52\xe8\xae\xff\xff\xff\x83\xc4\x0c\x01\x45\xf8\x83\x45\xfc\x01\x83\x7d\xfc\x09\x7e\xd8\xb8\x00\x00\x00\x00\xc9\xc3";

	ds_decode(ds, bytes, sizeof(bytes)-1, 0x640);
	struct dis *dis = NULL;
	int biter = 0;
	DS_FOREACH(ds, dis) {
		printf("%#08lx:\t", dis->address);
		for (int m=0,t=dis->used_bytes;m<10;m++,t=m<dis->used_bytes)
			t?printf("%02x ",bytes[biter++]):printf("   ");
		printf("\t%s\t%s\n",dis->mnemonic, dis->op_squash);
	}

	ds_destroy(ds);
	return 0;
}
